<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Trio">
<title>Trio</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #4e73df, #1cc88a);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.app {
  background: white;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 15px 30px rgba(0,0,0,0.2);
  text-align: center;
  width: 360px;
  position: relative;
}

#counter {
  font-size: 14px;
  margin-bottom: 15px;
  font-weight: 600;
  color: #555;
}

#grid {
  display: grid;
  grid-template-columns: repeat(7, 40px);
  gap: 6px;
  justify-content: center;
  margin-bottom: 20px;
}

.cell {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  background: #f8f9fc;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 600;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
  transition: 0.2s;
  cursor: pointer;
}

.selected { background: #d0e2ff; }
.revealed { background: #4e73df; color: white; }

@keyframes vanish {
  0%   { transform: scale(1); opacity: 1; }
  100% { transform: scale(0); opacity: 0; }
}

.removing {
  animation: vanish 0.3s ease forwards;
}

/* Spark animation */
@keyframes sparkle {
  0%   { transform: translate(0,0) scale(1); opacity: 1; }
  100% { transform: translate(var(--dx), var(--dy)) scale(0.5); opacity: 0; }
}

.sparkle {
  position: absolute;
  pointer-events: none;
  font-size: 16px;
  animation: sparkle 0.6s ease-out forwards;
}

/* Glow animation for reveal hint */
@keyframes glow {
  0%, 100% { box-shadow: 0 0 0px rgba(0,255,255,0); }
  50%      { box-shadow: 0 0 12px rgba(0,255,255,0.9); }
}

.glow {
  animation: glow 0.8s ease forwards;
}

button {
  padding: 10px 18px;
  border: none;
  border-radius: 12px;
  background: #4e73df;
  color: white;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  margin: 5px;
}

button:active { transform: scale(0.95); }
</style>
</head>

<body>
<div class="app">
  <h2>Trio</h2>
  <div id="counter">Anzahl: 0</div>
  <div id="grid"></div>
  <button onclick="revealNext()">Aufdecken</button>
  <button onclick="generateGrid()">Neues Spiel</button>
</div>

<script>
let size = 7;
let gridData = [];
let triplets = [];
let selectedCells = [];
let isAnimating = false;

function generateGrid() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  gridData = [];
  triplets = [];
  selectedCells = [];
  isAnimating = false;

  for (let r = 0; r < size; r++) {
    gridData[r] = [];
    for (let c = 0; c < size; c++) {
      let num = Math.floor(Math.random() * 9) + 1;
      gridData[r][c] = num;

      const cell = document.createElement("div");
      cell.className = "cell";
      cell.id = `cell-${r}-${c}`;
      cell.textContent = num;
      cell.onclick = () => selectCell(r,c);
      grid.appendChild(cell);
    }
  }

  findTriplets();
  updateCounter();
}

function isValidTriplet(a,b,c){
  return (a+b===c)||(a+c===b)||(b+c===a);
}

function findTriplets(){
  triplets = [];
  const directions=[[0,1],[1,0],[1,1],[1,-1]];

  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      for(let [dr,dc] of directions){
        let r2=r+dr, c2=c+dc;
        let r3=r+2*dr, c3=c+2*dc;

        if(r3>=0&&r3<size&&c3>=0&&c3<size){
          let a=gridData[r][c];
          let b=gridData[r2][c2];
          let cVal=gridData[r3][c3];

          if(a!=null && b!=null && cVal!=null && isValidTriplet(a,b,cVal)){
            triplets.push([[r,c],[r2,c2],[r3,c3]]);
          }
        }
      }
    }
  }
}

function selectCell(r,c){
  if(isAnimating || gridData[r][c]==null) return;
  const cell=document.getElementById(`cell-${r}-${c}`);
  cell.classList.toggle("selected");

  if(cell.classList.contains("selected")){
    selectedCells.push([r,c]);
  } else {
    selectedCells = selectedCells.filter(x=>!(x[0]===r && x[1]===c));
  }

  if(selectedCells.length===3){
    checkFoundTriplet();
  }
}

function checkFoundTriplet(){
  const coords = selectedCells.map(x=>x.toString()).sort().join("|");

  for(let t of triplets){
    const tcoords = t.map(x=>x.toString()).sort().join("|");
    if(coords===tcoords){
      removeTriplet(t);
      clearSelection();
      return;
    }
  }

  clearSelection();
}

function removeTriplet(triplet){
  if(isAnimating) return;
  isAnimating = true;
  const app = document.querySelector(".app");

  for(let [r,c] of triplet){
    const cell = document.getElementById(`cell-${r}-${c}`);
    cell.classList.remove("selected");
    cell.classList.add("removing");

    for(let i=0;i<5;i++){
      const sparkle = document.createElement("div");
      sparkle.className = "sparkle";
      sparkle.textContent = "âœ¨";
      const rect = cell.getBoundingClientRect();
      const appRect = app.getBoundingClientRect();
      sparkle.style.left = (rect.left - appRect.left + 12) + "px";
      sparkle.style.top = (rect.top - appRect.top + 12) + "px";

      const dx = (Math.random()*60 - 30) + "px";
      const dy = (Math.random()*60 - 30) + "px";
      sparkle.style.setProperty("--dx", dx);
      sparkle.style.setProperty("--dy", dy);

      app.appendChild(sparkle);
      setTimeout(()=>sparkle.remove(), 600);
    }
  }

  setTimeout(()=>{
    for(let [r,c] of triplet){
      gridData[r][c]=null;
      const cell=document.getElementById(`cell-${r}-${c}`);
      cell.textContent="";
      cell.classList.remove("removing");
      cell.style.visibility="hidden";
    }
    isAnimating=false;
    findTriplets();
    updateCounter();
  },300);
}

function clearSelection(){
  for(let [r,c] of selectedCells){
    const cell=document.getElementById(`cell-${r}-${c}`);
    if(cell) cell.classList.remove("selected");
  }
  selectedCells=[];
}

function updateCounter(){
  document.getElementById("counter").textContent=
    "Anzahl: "+triplets.length;
}

function revealNext(){
  for(let t of triplets){
    if(t.every(([r,c]) => gridData[r][c]!=null)){
      for(let [r,c] of t){
        const cell=document.getElementById(`cell-${r}-${c}`);
        cell.classList.add("revealed", "glow");
        // remove glow after animation
        setTimeout(()=>cell.classList.remove("glow"), 800);
      }
      triplets = triplets.filter(x => x !== t);
      updateCounter();
      return;
    }
  }
  alert("Alles aufgedeckt!");
}

generateGrid();
</script>
</body>
</html>